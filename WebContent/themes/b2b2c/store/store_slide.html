<#include '/common/header.html' /> 
<#include '/store/center_header.html'/>
<link rel="stylesheet" type="text/css" href="${ctx}/themes/b2b2c/css/uploadify.css" />
<script type="text/javascript" src="${ctx}/themes/b2b2c/js/jquery.uploadify.min.js"></script>
<script src="${ctx}/themes/b2b2c/js/store_slide.js" charset="utf-8"></script>
<!-- 引入幻灯片JS -->
<script type="text/javascript" src="${ctx}/themes/b2b2c/js/jquery.flexslider-min.js"></script>

<!-- 调用店铺幻灯片标签 -->
<#assign storeSlideListTag=newTag("storeSlideListTag")> 
<#assign storeSlideList=storeSlideListTag()>
<div class="layout">
	<#include '../left_menu.html'/>
	<div class="right-content">
		<div class="main">
			<div class="wrap">
				<div class="path">
					<div>
						<a href="${ctx}/store/business_center.html">商家中心</a> <span>&gt;</span>店铺幻灯片设置
					</div>
				</div>
				<div class="flexslider">
					<ul class="slides">
						<#list storeSlideList as storeSlide>
							<li>
								<@image src="${storeSlide.img!''}" />
							</li>
						</#list>
					</ul>
				</div>
				<form method="post" id="slideForm" >
					<!-- 图片上传部分 -->
					<ul id="goods_images" class="store-slider">
						<#list storeSlideList as storeSlide>
							<li >
								<input type="hidden" name="silde_id" value="${storeSlide.silde_id}"/>
								<input type="hidden" id="fs_img${storeSlide.silde_id}" name="store_fs" value="${storeSlide.img!''}"/>
								<div class="picture">
									<span class="thumb size142-80"><i></i> 
										<#if storeSlide.img??>
											<@image src="${storeSlide.img}" id="img${storeSlide.silde_id}" width="142" height="80"/>
											<#else>
											<img id="img${storeSlide.silde_id}" width="142" height="80" src="${ctx}/themes/b2b2c/images/default_sildeshow.gif" style="display: inline;"> 
										</#if>
										
									</span>
								</div>
								<div class="url">
									<label>跳转URL...</label> 
									<input type="text" value="${storeSlide.silde_url!''}" name="silde_url" class="text">
								</div>
								<div class="upload-btn">
									<a href="javascript:void(0);"> 
										<input type="file" id="slideFile${storeSlide.silde_id}" fs="${storeSlide.silde_id}">
									</a>
								</div>
							</li>
						</#list>
					</ul>
					<div class="ncm-notes">
						<ul>
							<li>最多可上传5张幻灯片图片。</li>
							<li>支持jpg、jpeg、gif、png格式上传，建议图片宽度790px、高度在300px到400px之间、大小1.00M以内的图片。提交2~5张图片可以进行幻灯片播放，一张图片没有幻灯片播放效果。</li>
							<li>操作完成以后，按“提交”按钮，可以在当前页面进行幻灯片展示。</li>
							<li>跳转链接必须带有<b style="color: red;">“http://”</b></li>
						</ul>
					</div>

					<!-- 图片上传部分 -->
					<input type="button" id="saveSlide" style="margin: 20px;" value="提交" class="btn submit">
				</form>
			</div>
		</div>
	</div>
</div>

<style>
/*焦点图轮换
*********************************/ 
.flex-container a:active, .flexslider a:active {
	outline: none;
}
.slides, .flex-control-nav, .flex-direction-nav {
	margin: 0;
	padding: 0;
	list-style: none;
}
.flexslider {
	width: 790px;
	clear: both;
	margin: 5px 5px;
*margin: 0 auto 5px auto;
	padding: 0;
}
.flexslider .slides > li {
	display: none;
}
.flexslider .slides img {
	max-width: 100%;
	display: block;
}
.flex-pauseplay span {
	text-transform: capitalize;
}
.slides:after {
	content: ".";
	display: block;
	clear: both;
	visibility: hidden;
	line-height: 0;
	height: 0;
}
html[xmlns] .slides {
	display: block;
}
* html .slides {
	height: 1%;
}
.no-js .slides > li:first-child {
	display: block;
}
.flexslider {
	background: #fff;
	position: relative;
	zoom: 1;
}
.flexslider .slides {
	zoom: 1;
}
.flexslider .slides > li {
	position: relative;
}
.flex-container {
	zoom: 1;
	position: relative;
}
.flex-direction-nav li a {
	text-indent: -9999px;
	background-color: transparent;
	display: block;
	width: 36px;
	height: 36px;
	padding: 0;
	margin: -8px 0 0 0;
	position: absolute;
	top: 45%;
	cursor: pointer;
	opacity: 0.3;
	filter: alpha(opacity=30);
}
.flex-direction-nav li a:hover {
	opacity: 0.9;
	filter: alpha(opacity=90)
}
.flex-direction-nav li .next {
	font-size: 0px;
	line-height: 0;
	width: 0px;
	height: 0px;
	border: 16px solid;
	border-color: transparent transparent transparent #333;
	right: 0px;
}
.flex-direction-nav li .prev {
	font-size: 0px;
	line-height: 0;
	width: 0px;
	height: 0px;
	border: 16px solid;
	border-color: transparent #333 transparent transparent;
	left: 0px;
}
.flex-direction-nav li .disabled {
	opacity: .3;
	filter: alpha(opacity=30);
	cursor: default;
}
.flex-control-nav {
	width: 100%;
	position: absolute;
	bottom: -20px;
*bottom: 5px;
	text-align: center;
}
.flex-control-nav li {
	margin: 0 0 0 9px;
	_margin-left: 4px;
	display: inline-block;
	zoom: 1;
*display: inline;
}
.flex-control-nav li:first-child {
	margin: 0;
}
.flex-control-nav li a {
	width: 10px;
	height: 10px;
	line-height: 10px;
	display: block;
	background-color: #EEE;
	cursor: pointer;
	text-indent: -9999px;
	border-radius: 5px;
}
.flex-control-nav li a:hover {
	background-color: #FC0;
}
.flex-control-nav li a.active {
	background-color: #F60;
	cursor: default;
	box-shadow: 1px 1px 1px #CC3300 inset;
}
</style>

<script type="text/javascript">
	$(function() {
		window.onload=function(){
			<#list storeSlideList as storeSlide>
			bindFileEvent($("#slideFile${storeSlide.silde_id}"));
			</#list>
		}
		$("#saveSlide").click(function() {
			var options = {
				url : "${ctx}/api/b2b2c/storeSilde!editStoreSilde.do?ajax=yes",
				type : "POST",
				dataType : 'json',
				success : function(data) {
					alert(data.message);
					if (data.result == 1) {
						location.href="business_center.html";
					}
				},
				error : function(e) {
					alert("出现错误 ，请重试");
				}
			};
			$("#slideForm").ajaxSubmit(options);
		});
	})
	function bindFileEvent(obj) {
		$(obj).uploadify({
			'buttonText' : '上传', //显示文字
			'fileObjName' : 'image', //文件对象名称
			//上传文件大小限制 'fileSizeLimit':'100KB',
			'fileTypeDesc' : '请选择',//允许上传的文件类型的描述，在弹出的文件选择框里会显示 
			'fileTypeExts' : '*.gif; *.jpg; *.png',//允许上传的文件类型，限制弹出文件选择框里能选择的文件 
			'uploader' : '${ctx}/api/base/upload-image.do?subFolder=store',
			'swf' : '${ctx}/themes/b2b2c/uploadify.swf',
			'height' : '20', //高度
			'width' : '70',
			'multi' : true, //是否支持多文件上传
			'progressData' : 'percentage',//设置文件上传时显示的数据
			'uploadLimit' : 5,
			'onFallback' : function() { //falsh兼容
				alert("麻烦了，不兼容falsh!");
			},
			'onUploadSuccess' : function(file, data, response) {
				var img = jQuery.parseJSON(data);
				var fs = $(obj).attr("fs");
				$("#img" + fs).attr("src", img.img);
				$("#fs_img" + fs).val(img.fsimg);
			},
			'onSelectError' : function(file, errorCode, errorMsg) {
				if (errorCode == SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED) {
					this.queueData.errorMsg = "最多只能上传五个";
				}
				if (errorCode == SWFUpload.QUEUE_ERROR.INVALID_FILETYPE) {
					this.queueData.errorMsg = "请上传正确的格式";
				}
			}
		});
	}
</script>

<#include '/common/footer.html' />
