<#include '/admin/header.html' ><#assign regionSelectDirective="com.enation.app.shop.core.tag.regions.RegionSelectDirective"?new()><style>.input_text{	width: 95%;}</style><div id="loading"></div><div class="main">	<form id="searchform">		<input type="hidden" name="taskId" id ="taskId">	<!-- 		<div id="tb" style="height: auto">					 				<span style="float: right;"> 				<span id="simpleSearch">					<input id="searchKeyword" class="input_text" type="text" value="" size="30" style="width: 300px;"					placeholder="请输入条件" name="searchKeyWord"> 					<a href="javascript:void(0)" class="easyui-linkbutton" 					data-options="plain:true" onclick="searchAppeal()">搜索</a>				</span>				<a href="javascript:void(0)" class="button" id="aAdvanced"  >高级搜索</a>			</span>		</div>				<div style="display: block;" class="searchAdvanced" >		<input id="Advanced" name="Advanced" type="hidden" value="0" />			<table width="98%" border="0" cellspacing="0" cellpadding="8">				<tr>					<th width="70" align="right">原因</th>					<td>						<input type="text" value="${reason!''}" id="reason"  class="input_text">					</td>										<th width="70" align="right">创建时间</th>					<td>						<input class="easyui-datebox" style="width: 90px;height: 28px;" id="start_time" />                        <span>&nbsp;~&nbsp;</span>                        <input class="easyui-datebox" style="width: 90px;height: 28px;" id="end_time" />										</td>					<th width="280" align="right"></th>					<td>					</td>				</tr>				<tr>					<td width="60" align="right"></td>					<td colspan="7" align="center">						<a id="searchAdvance" class="button blueButton" onclick="searchAppeal()" href="javascript:;">开始搜索</a>					</td>				</tr>			</table>		</div>		 -->		<div class="clear height10"></div>		<div class="shadowBoxWhite tableDiv">		<table class="easyui-datagrid"			data-options="url:'appeal!todoListJson.do',pageList: [5,10,15,20],pageSize:${pageSize},fitColumns:'true'"			pagination="true" id="memberdata" sortName="create_time" sortOrder="desc" >			<thead>				<tr>					<th data-options="field:'title',width:150,align:'center'">标题</th>					<th data-options="field:'member_name',width:80,align:'center'">申请人</th>					<th data-options="field:'bill_appeal_date',width:120,align:'center'" formatter="formattime">申请时间</th>					<th data-options="field:'name',width:120,align:'center'">审批环节</th>					<th data-options="field:'creatTime',width:100,align:'center'">到达时间</th>					<th data-options="field:'assignee',hidden:'true'"></th>					<th data-options="field:'id',hidden:'true'"></th>					<th data-options="field:'taskDefinitionKey',hidden:'true'">test</th>					<th data-options="field:'processInstanceId',hidden:'true'"></th>					<th data-options="field:'action',width:100,align:'center'"						formatter="formatOperation">操作</th>				</tr>			</thead>		</table>		</div>	</form>	<div id="divdia" style="display: none;"></div></div><script type="text/javascript">		function submitForm(map) {		var formflag = $(map["formId"]).form().form('validate');		if (formflag) {			$.Loading.show(map["loadshow"]);			var options = {				url : map["url"],				type : "POST",				dataType : 'json',				success : function(result) {					if (result.result == 1) {						$.Loading.show(result.message);						$(map["divDialog"]).dialog('close');						$(map["gridreload"]).datagrid('reload');					}					if (result.result == 0) {						$.Loading.error(result.message);					}					$.Loading.hide();				},				error : function(e) {					alert("出现错误 ，请重试");				}			};			$(map["formId"]).ajaxSubmit(options);		}	}		function claimTask(taskId) {		$("#taskId").val(taskId);		$.Loading.show("正在认领任务......");		//$("#claimButton").linkbutton("disable");		var options = {			url : "appeal!claim.do?ajax=yes",			type : "POST",			dataType : 'json',			success : function(result) {				if (result.result == 1) {					$.Loading.success("认领任务成功");										newTab("待办任务",							"${ctx}/b2b2c/admin/appeal!todolist.do");				}				if (result.result == 0) {					$.Loading.error(result.message);				}				//$("#claimButton").linkbutton("enable");							},			error : function(e) {				alert("出现错误 ，请重试");				//$("#claimButton").linkbutton("enable");				$.Loading.hide();			}		};		$("#searchform").ajaxSubmit(options);			}	function clearForm(map) {		$(map["formId"]).form('clear');	}	function formatOperation(value, row, index) {		var val = '';		if (row.assignee == null || row.assignee == '') {			val = "<a id=\"claimButton\" title='认领' href='javascript:void(0);' onclick='claimTask(\""				+ row.id + "\")' >认领</a>";		}  else {			val += "<a  title='处理' href='javascript:void(0);' onclick='newTab(\""				+ row.id				+ "-审批\",\"${ctx}/b2b2c/admin/appeal!toApprovalPage.do?processInstanceId="				+ row.processInstanceId + "&id=" + row.id + "&name=" + row.name + "&taskDefinitionKey=" + row.taskDefinitionKey +"\")' >处理</a>";		}						return val;	}	function formattime(value, row, index) {		return getFormatDateByLong(value, "yyyy-MM-dd hh:mm:ss");	}		$(function(){		$(".searchAdvanced").hide();		//高级查询按钮	    $("#aAdvanced").click(function () {	        if ($("#Advanced").val() == "0") {	            $("#Advanced").val(1);	            $("#simpleSearch").hide();	            //$("#aAdvanced").text("简单搜索")	            $("#aAdvanced").addClass("searchAdvancedS");	        } else {	            $("#Advanced").val(0);	            $("#simpleSearch").show();	            //$("#aAdvanced").text("高级搜索");	            $("#aAdvanced").removeClass("searchAdvancedS");	        }	        $(".searchAdvanced").slideToggle("slow");	    });	});		function searchAppeal(){				var searchtype = $("#Advanced").val();		var keyword = $("#searchKeyword").val();		var start_time = $('#start_time').datebox('getValue');		var end_time = $('#end_time').datebox('getValue');  			$("#memberdata").datagrid('load', {			 stype:searchtype,			 keyword:keyword,			 start_time:start_time,			 end_time:end_time,			 page:1	    });	}	</script><#include '/admin/footer.html' >